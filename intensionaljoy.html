<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <title>Intensional Joy (a concatenative account of internal structure) — Christine's World Wide Web Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><meta name="generator" content="soupault"></head>
  <body>
    <main>
      <article>
        <p id="author"><a href="./">@pithlessly</a> · <a href="https://github.com/pithlessly">github</a> · λ</p>
        
      <h1>Intensional Joy (a concatenative account of internal structure)</h1>
<p><time datetime="2025-02-11">Date: 2025-02-11</time></p>
<p><em>Intensional</em> programming languages (no, I didn’t say <em>intentional</em>)
have had a bit of a moment in the spotlight recently.
Specifically, back in December,
Johannes Bader’s website on <a href="https://treecalcul.us">tree calculus</a>
popularized some work on intensional rewriting systems
which was largely spearheaded by Dr. Barry Jay.
These are systems that resemble <a href="https://en.wikipedia.org/wiki/Combinatory_logic#Combinatory_calculi">combinatory calculi</a> like SKI,
but have the ability to treat functions as more than just black boxes —
you can look inside a function to see the code that defines it and do things with that.</p>
<p>Dr. Jay and collaborators have developed a number of variants
— SF calculus, tree calculus, triage calculus, etc. —
but they embody this same core idea for my purposes.</p>
<p>Today I want to take the idea of intensional programming and try to transfer the ideas from
combinators to a different domain: <a href="https://en.wikipedia.org/wiki/Concatenative_programming_language">concatenative programming</a>.
I have further thoughts about tree calculus, but they’re best left for another post.</p>
<h3>About the name</h3>
<p>In philosophy, when we describe a thing,
we take an <em>extensional</em> view when we care only about the thing being described
and an <em>intensional</em> view when we care about the way it was described.
By analogy in programming we say that
the extensional view of a piece of code encompasses only its I/O behavior
and the intensional view encompasses its implementation details.
So mergesort and (stable) heapsort are the same extensionally but different intensionally.</p>
<h2>Brief introduction to Joy</h2>
<p><a href="https://en.wikipedia.org/wiki/Joy_(programming_language)">Joy</a>
is a language which tries to capture the essence of concatenative programming.
I’ll use a simplified version here which can be presented as a
stack-based language or a system of rewriting rules.</p>
<p>Joy’s syntax is as follows: a program consists of zero or more <em>commands</em>,
and a command is either a program wrapped in square brackets (a <em>quotation</em>)
or one of {<code>dup</code>, <code>swap</code>, <code>pop</code>, <code>cat</code>, <code>quote</code>, <code>eval</code>} (the <em>operators</em>).</p>
<h3>Stack-based semantics</h3>
<p>A Joy program executes on a stack which contains programs.
Each command has a certain behavior when executed:</p>
<ul>
<li>Executing a quotation <code>[p]</code> pushes <code>p</code> to the stack.</li>
<li><code>dup</code> duplicates the top element of the stack.</li>
<li><code>swap</code> swaps the top two elements of the stack.</li>
<li><code>pop</code> removes the top element of the stack.</li>
<li><code>cat</code> takes two elements off the stack and concatenates them,
with the topmost element coming second.</li>
<li><code>quote</code> takes the top element <code>p</code> off the stack and pushes <code>[p]</code>
(a single-command program consisting of a quotation).</li>
<li><code>eval</code> takes the top program off the stack and executes it.</li>
</ul>
<p>So for example the Joy program
<code>[dup dup dup] [[pop pop]] swap quote cat eval dup cat</code>
results in a stack containing the two programs
<code>pop pop</code> and <code>dup dup dup dup dup dup</code>.</p>
<h3>Rewriting semantics</h3>
<p>I’ll denote the rewriting relation by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span>
and use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a, b, c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span></span></span></span> to range over arbitrary programs.</p>
<p>The execution of a Joy program can then be described by a sequence of rewrites:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>dup</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>swap</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>pop</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mi>ϵ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>cat</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mi>a</mi><mi>b</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>quote</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>eval</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mi>a</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
       [a] \, \text{dup}   &amp;\to [a] \, [a] \\
[a] \, [b] \, \text{swap}  &amp;\to [b] \, [a] \\
       [a] \, \text{pop}   &amp;\to \epsilon \\
[a] \, [b] \, \text{cat}   &amp;\to [a b] \\
       [a] \, \text{quote} &amp;\to [[a]] \\
       [a] \, \text{eval}  &amp;\to a \\
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9em;vertical-align:-4.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.75em;"><span style="top:-6.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">dup</span></span></span></span><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">swap</span></span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">pop</span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">cat</span></span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">quote</span></span></span></span><span style="top:0.59em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">eval</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.75em;"><span style="top:-6.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span></span></span><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ϵ</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord mathnormal">ab</span><span class="mclose">]</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[[</span><span class="mord mathnormal">a</span><span class="mclose">]]</span></span></span><span style="top:0.59em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>If we always apply the leftmost rewrite which is not inside a quotation,
then we get a notion of “applicative order reduction”
which simulates the stack-based semantics.
(Think of the sequence of quotations coming before the leftmost operator as representing the stack.)</p>
<p>The code example I gave about reduces as follows (redexes in blue):</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext>&nbsp;swap</mtext></mstyle></mpadded><mtext>&nbsp;quote&nbsp;cat&nbsp;eval&nbsp;dup&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mtext>&nbsp;quote</mtext></mstyle></mpadded><mtext>&nbsp;cat&nbsp;eval&nbsp;dup&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext>&nbsp;cat</mtext></mstyle></mpadded><mtext>&nbsp;eval&nbsp;dup&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext>&nbsp;eval</mtext></mstyle></mpadded><mtext>&nbsp;dup&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mtext>&nbsp;dup</mtext></mstyle></mpadded><mtext>&nbsp;cat</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mpadded width="+6pt" height="+6pt" lspace="3pt" voffset="3pt" mathbackground="#ccccff"><mstyle scriptlevel="0" displaystyle="false"><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo><mtext>&nbsp;cat</mtext></mstyle></mpadded></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>pop&nbsp;pop</mtext><mo stretchy="false">]</mo><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><mtext>dup&nbsp;dup&nbsp;dup&nbsp;dup&nbsp;dup&nbsp;dup</mtext><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
        &amp; \space \colorbox{#ccccff}{$ [\text{dup dup dup}] \space [[\text{pop pop}]] \text{ swap} $} \text{ quote cat eval dup cat}
\\  \to &amp; \space [[\text{pop pop}]] \space \colorbox{#ccccff}{$ [\text{dup dup dup}] \text{ quote} $} \text{ cat eval dup cat}
\\  \to &amp; \space \colorbox{#ccccff}{$ [[\text{pop pop}]] \space [[\text{dup dup dup}]] \text{ cat} $} \text{ eval dup cat}
\\  \to &amp; \space \colorbox{#ccccff}{$ [[\text{pop pop}] \space [\text{dup dup dup}]] \text{ eval} $} \text{ dup cat}
\\  \to &amp; \space [\text{pop pop}] \space \colorbox{#ccccff}{$ [\text{dup dup dup}] \text{ dup} $} \text{ cat}
\\  \to &amp; \space [\text{pop pop}] \space \colorbox{#ccccff}{$ [\text{dup dup dup}] \space [\text{dup dup dup}] \text{ cat} $}
\\  \to &amp; \space [\text{pop pop}] \space [\text{dup dup dup dup dup dup}]
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:12.9em;vertical-align:-6.2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.7em;"><span style="top:-8.7em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"></span></span><span style="top:-6.8em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span><span style="top:-1.1em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span><span style="top:0.8em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span><span style="top:2.49em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mrel">→</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:6.7em;"><span style="top:-8.7em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mopen">[[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]]</span><span class="mord text"><span class="mord">&nbsp;swap</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;quote&nbsp;cat&nbsp;eval&nbsp;dup&nbsp;cat</span></span></span></span><span style="top:-6.8em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]]</span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;quote</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;cat&nbsp;eval&nbsp;dup&nbsp;cat</span></span></span></span><span style="top:-4.9em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]]</span><span class="mspace">&nbsp;</span><span class="mopen">[[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]]</span><span class="mord text"><span class="mord">&nbsp;cat</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;eval&nbsp;dup&nbsp;cat</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]]</span><span class="mord text"><span class="mord">&nbsp;eval</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;dup&nbsp;cat</span></span></span></span><span style="top:-1.1em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;dup</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;cat</span></span></span></span><span style="top:0.8em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-3.05em;"><span class="pstrut" style="height:3.6em;"></span><span class="stretchy colorbox" style="height:1.6em;background-color:#ccccff;"></span></span><span style="top:-3.6em;"><span class="pstrut" style="height:3.6em;"></span><span class="mord boxpad"><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;cat</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.55em;"><span></span></span></span></span></span></span></span><span style="top:2.49em;"><span class="pstrut" style="height:3.05em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">pop&nbsp;pop</span></span><span class="mclose">]</span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord text"><span class="mord">dup&nbsp;dup&nbsp;dup&nbsp;dup&nbsp;dup&nbsp;dup</span></span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.2em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<h2>Making Joy intensional with one operator</h2>
<p>Joy is extensional — it has no way to “take apart” a quotation into its consituent parts.
The only way to inspect a program given on the stack is to <code>eval</code> it,
which only tells us about the extensional behavior of that program,
not its intensional properties.</p>
<p>Is there a single primitive we can add to Joy which gives it the ability to introspect programs?</p>
<p>My friend <a href="https://olus2000.pl/">@olus2000</a> described an intensional operator <code>map</code>:</p>
<blockquote>
<p><code>A B C map</code> would map over every element of A applying B if it’s a primitive [i.e. operator] or C if it’s a quotation</p>
</blockquote>
<p>This can be described in the rewriting semantics as follows:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>map</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mi>ϵ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mi>p</mi><mo stretchy="false">]</mo><mtext> </mtext><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>map</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mi>p</mi><mo stretchy="false">]</mo><mtext> </mtext><mi>c</mi><mtext> </mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>map</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>o</mi><mtext> </mtext><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>map</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mi>o</mi><mo stretchy="false">]</mo><mtext> </mtext><mi>b</mi><mtext> </mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>b</mi><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>map</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>if&nbsp;</mtext><mstyle scriptlevel="0" displaystyle="false"><mi>o</mi></mstyle><mtext>&nbsp;is&nbsp;an&nbsp;operator</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
        [] \, [b] \, [c] \, \text{map} &amp;\to \epsilon \\
[[p] \, a] \, [b] \, [c] \, \text{map} &amp;\to [p] \, c \, [a] \, [b] \, [c] \, \text{map} \\
  [o \, a] \, [b] \, [c] \, \text{map} &amp;\to [o] \, b \, [a] \, [b] \, [c] \, \text{map} &amp; \text{if $o$ is an operator} \\
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">map</span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[[</span><span class="mord mathnormal">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">map</span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">map</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">ϵ</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord mathnormal">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">map</span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mord mathnormal">o</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">map</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.5em;"><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">if&nbsp;</span><span class="mord mathnormal">o</span><span class="mord">&nbsp;is&nbsp;an&nbsp;operator</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>I want to describe another operator, which is simpler but more unwieldy.
Named <code>quota</code>, its behavior is to pop a single program from the stack and
surround every command in that program (including quotations) in a quotation.
For example, <code>[quote [dup eval] cat] quota</code> creates the program
<code>[quote] [[dup eval]] [cat]</code> on the stack.</p>
<p>The rewriting semantics are a little annoying, but can be expressed with a similar recursive rule:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mtext>quota</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">[</mo><mi>c</mi><mtext> </mtext><mi>a</mi><mo stretchy="false">]</mo><mtext> </mtext><mtext>quota</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>→</mo><mo stretchy="false">[</mo><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>a</mi><mo stretchy="false">]</mo><mtext>&nbsp;quota&nbsp;cat</mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mtext>if&nbsp;</mtext><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle><mtext>&nbsp;is&nbsp;a&nbsp;command</mtext></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
      [] \, \text{quota} &amp;\to [] \\
[c \, a] \, \text{quota} &amp;\to [[c]] \, [a] \text{ quota cat} &amp;\text{if $c$ is a command}
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">quota</span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">quota</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[</span><span class="mclose">]</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">[[</span><span class="mord mathnormal">c</span><span class="mclose">]]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;quota&nbsp;cat</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.25em;"><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">if&nbsp;</span><span class="mord mathnormal">c</span><span class="mord">&nbsp;is&nbsp;a&nbsp;command</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>(Recall that the difference between commands and operators is that quotations are commands.)</p>
<h3>Equivalence of <code>map</code> and <code>quota</code></h3>
<p>I want to show that these two intensional operators can be expressed in terms of each other.
The reduction <code>quota</code> → <code>map</code> (that is, expressing <code>quota</code> in terms of <code>map</code>)
is not very complicated, so I’ll focus on the more interesting side:
expressing <code>map</code> in terms of <code>quota</code>.</p>
<p>Suppose we have a quoted command <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[c]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span></span></span></span> on the stack.
To emulate the behavior of <code>map</code>, we need to detect whether it’s a quotation.</p>
<p>With the sole exception of <code>dup</code>,
every operator we’ve introduced so far have the following two properties:</p>
<ul>
<li>They take at most three arguments;</li>
<li>If their arguments are all empty, then their execution either
shrinks the stack or keeps it the same size.</li>
</ul>
<p>Quotations and <code>dup</code> are the only commands which grow the stack in this scenario.
Imagine a program which looks like this:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext>&nbsp;eval&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</mtext></mrow><annotation encoding="application/x-tex">
[X_1] \, [\text{eval}] \, [\text{eval}] \, [\text{eval}] \, [X_2] \, [] \, [] \, [] \, [c] \text{ eval pop pop pop pop eval}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;eval&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</span></span></span></span></span></span>
<p>If <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> transforms the three empty quotations into three or fewer stack elements,
then the <code>pop</code> commands will remove all of these elements, as well as the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[X_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> quotation,
and we will be left with just <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[X_1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> and zero or more <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[\text{eval}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span></span></span></span> quotations.
The final use of <code>eval</code> will start a daisy-chain that ultimately reduces the whole expression to just <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">X_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>On the other hand, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> creates an additional element on the stack,
then the expression will reduce like:</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mi>c</mi><mo stretchy="false">]</mo><mtext>&nbsp;eval&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mo>→</mo><mo>∗</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo>…</mo><mtext> </mtext><mo stretchy="false">]</mo><mtext>&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msup><mo>→</mo><mo>∗</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mtext>&nbsp;eval</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">→</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mtext>&nbsp;</mtext><mo stretchy="false">[</mo><msub><mi>X</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mtext>eval</mtext><mo stretchy="false">]</mo><mtext> </mtext><msub><mi>X</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
         &amp; \space [X_1] \, [\text{eval}] \, [\text{eval}] \, [\text{eval}] \, [X_2] \, [] \, [] \, [] \, [c] \text{ eval pop pop pop pop eval}
\\ \to^* &amp; \space [X_1] \, [\text{eval}] \, [\text{eval}] \, [\text{eval}] \, [X_2] \, [] \, [] \, [] \, [\dots] \text{ pop pop pop pop eval}
\\ \to^* &amp; \space [X_1] \, [\text{eval}] \, [\text{eval}] \, [\text{eval}] \, [X_2] \text{ eval}
\\ \to   &amp; \space [X_1] \, [\text{eval}] \, [\text{eval}] \, [\text{eval}] \, X_2
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel"><span class="mrel">→</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel"><span class="mrel">→</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7387em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">→</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord mathnormal">c</span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;eval&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</span></span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;pop&nbsp;eval</span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord text"><span class="mord">&nbsp;eval</span></span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace">&nbsp;</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">eval</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>Thus this snippet effectively discriminates between two sets of commands:
<code>dup</code> and quotations (for which <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">X_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> will run)
and everything else (for which <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">X_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> will run).</p>
<p>Believe it or not, we’re now almost done:
if we can find a way to distinguish <code>dup</code> from a quotation,
we’ll have everything we need to implement <code>map</code>.</p>
<p>Putting together the implementation is just an exercise in Joy programming —
the only tricky bit is that <code>quota</code> creates a subprogram which pushes a lot of stuff
to the stack, and we need to be able to write a loop which iterates over all this stuff.
Knowing when to <em>stop</em> the loop requires we put a “flag” on the stack
which is clearly distinguishable from any command.
One simple choice is a program that pushes two elements, like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">]</mo><mtext> </mtext><mo stretchy="false">[</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[] \, []</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">[</span><span class="mclose">]</span></span></span></span>.
If we do this, we need to modify the above template program to also handle this third case and
ensure iteration of the loop is stopped.</p>
<h3>Distinguishing <code>dup</code> from a quotation</h3>
<p>When I originally realized the problem of needing to distinguish <code>dup</code> from a quotation
in subprogram <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">X_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>,
I actually wondered if it was impossible.
The problem here is that both of these commands will push a single element <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to the stack
but we are limited in our ability to actually analyze this element.
We can’t <code>eval</code> it, since it could be an arbitrary subprogram.
And precisely because it is arbitrary, it doesn’t seem like there is anything
we can do to reliably distinguish it from the program that would be created by <code>dup</code>.</p>
<p>Thinking about it more, though, it turns out that it actually <em>is</em> possible
if we allow ourselves more invocations of <code>quota</code> — this time to introspect <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>The result of <code>quota</code> will be a subprogram consisting of some number of quotations,
each of which consists of a single command.</p>
<p>We can once again use standard Joy programming techniques to count the number of these quotations.
This time, we don’t need to distinguish any of the commands from each other;
we just need to be able to identify some the stop condition.
So we end up with a snippet similar to one from the last section, but a little simpler.</p>
<p>This gives us a decidable way to count the number of commands in any program.
This is what finally lets us figure out <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>:
if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> is a quotation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>c</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">c = [c_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> then
every time we count the number of commands in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, the result will be the same.
OTOH, if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mtext>dup</mtext></mrow><annotation encoding="application/x-tex">c = \text{dup}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">dup</span></span></span></span></span> then
we can run <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> with an empty program atop the stack, and we will observe that
this results in the length of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> being zero.
Then if we run <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> again with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mclose">]</span></span></span></span> atop the stack, we will instead observe
that the length of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.</p>
<p>In other words, we don’t recognize a quotation by any particular output,
but by the way the output length is <em>dependent</em> on the contents of the stack.</p>
<h2>Conclusions</h2>
<p>I’ve now presented two different operators for intensional programming in a concatenative language,
<code>map</code> and <code>quota</code>.
<code>quota</code> is incredibly simple to describe, but a bit more complicated to use,
whereas <code>map</code> is easy to use, but is arguably more complex since it subsumes the behavior
of other operators (namely, it is capable of evaluating quotations,
making it a bit redundant with <code>eval</code>).</p>
<p>Nevertheless, we’ve shown that each of these operators can have its behavior
captured by the other.
Normally I would say unequivocally that this makes these operators equivalent.
However, in an intensional setting, equivalence is more complicated —
<code>map</code> may be equivalent in <em>behavior</em> to an subprogram defined in terms of <code>quota</code>,
but an intensional program would still be able to distinguish that
the former is a single operator and the latter is a subprogram with multiple commands.
I think that it would be valuable for future researchers to come up with a weaker general
notion of equivalence that allows us to talk about intensional languages.</p>
<p>That said, I think I’ve provided evidence here that we have a notion of
how to bring intensionality to a language like Joy that’s robust
to exactly which primitive you introduce for it.</p>
<p>Although Joy is a very minimalist setting to work in,
it wouldn’t be difficult to bring these operators into richer language
as long as that language had the same basic syntactic structure.
For example,
one of the key assumptions we’re making about the syntactic structure of the language
is that we don’t have to think about variable binding.</p>
<p>I think that, at the moment, the resarch of Dr. Jay and collaborators
also leans on this conceptual simplification —
it’s the reason their intensional calculi are based on combinatory calculi rather than
lambda calculus.
It may be possible to move past this limitation by bringing in ideas
from languages with native ideas of variable binding, like λProlog and FreshML,
but I will need more research to figure out exactly what these languages are doing.</p>
<h2>What do the full versions of the reductions look like?</h2>
<p>The reader is encouraged to try putting together some real Joy code
that implements <code>map</code> in terms of <code>quota</code> and vice versa.</p>
</article>
      <footer>
        <div>
          <a href="https://soupault.app/"><img src="./buttons/powered-by-soupault.png"></a>
          <img src="./buttons/bookmark_this_page.gif">
          <img src="./buttons/trans-flag.png">
          <img src="./buttons/ace-flag.png">
          <img src="./buttons/firefox.gif">
          <img src="./buttons/fediverse.gif" class="sharp">
          <img src="./buttons/i-was-on-cohost.webp">
          <a href="https://tailscale.com/"><img src="./buttons/tailscale.png"></a>
          <a href="https://bitwarden.com/"><img src="./buttons/bitwarden.gif" class="sharp"></a>
          <a href="https://haskell.org"><img src="./buttons/haskell.png"></a>
          <img src="./buttons/linux.gif">
          <img src="./buttons/sun.gif">
          <a href="https://archive.org/"><img src="./buttons/internetarchive.gif"></a>
          <img src="./buttons/antinft.gif">
          <img src="./buttons/iso8601.png">
        </div>
        <br>
        <div>
          <a href="https://roseiverse.com"><img src="https://roseiverse.com/buttons/roseiverse.png" width="88" height="31"></a>
          <a href="https://fireis.dev/"><img src="./buttons/fireisgood.png" style="outline:1px solid black;"></a>
          <a href="https://razetime.github.io/"><img src="./buttons/razetime.png"></a>
          <a href="https://razetime.github.io/"><img src="./buttons/allzetime.png"></a>
        </div>
      </footer>
    </main>
  

</body></html>